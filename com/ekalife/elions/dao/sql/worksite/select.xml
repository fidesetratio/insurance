<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>

	<cacheModel id="elions.worksite.cache.references" type="LRU" readOnly="true"
		serialize="false">
		<flushInterval hours="8" />
		<property name="cache-size" value="100" />
		<flushOnExecute statement="elions.common.resetIbatisCache"/>
		<!-- <flushOnExecute statement="insert.history"/> -->
	</cacheModel>
	
	<resultMap id="elions.worksite.select_nama_perusahaan1" class="java.util.HashMap">
		<result property="MCL_ID" column="MCL_ID" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                      
		<result property="MCL_FIRST" column="MCL_FIRST" javaType="string" jdbcType="VARCHAR2" nullValue=""/> 
	</resultMap>
	
	<select id="elions.worksite.select_nama_perusahaan2" resultClass="java.util.HashMap" parameterClass="java.util.HashMap" >
		SELECT   c.mcl_id key, c.mcl_first value
		    FROM eka.mst_policy b, eka.mst_insured a, eka.mst_client c
		   WHERE b.lstb_id = 1
		     AND b.reg_spaj = a.reg_spaj
		     AND a.mste_flag_cc = 3
		     AND b.mspo_customer = c.mcl_id
		GROUP BY c.mcl_id, c.mcl_first
		ORDER BY c.mcl_first
	</select>
	
	<select id="elions.worksite.selectNoPreMstPerusahaan" resultClass="string" parameterClass="java.util.HashMap" >
		 SELECT no_pre, periode
       			 FROM eka.mst_diskon_perusahaan
        WHERE mcl_id =#mclId#
      			  AND periode =#periode#
	</select>
	
	<resultMap id="elions.worksite.selectCompanyWsMap" class="java.util.HashMap">
		<result property="MCL_FIRST" column="MCL_FIRST" javaType="string" jdbcType="VARCHAR2" nullValue=""/>     
		<result property="MCL_ID" column="MCL_ID" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                      
		<result property="PERIODE" column="PERIODE" javaType="string" jdbcType="CHAR" nullValue=""/>
		<result property="PERIODE" column="PERIODE" javaType="string" jdbcType="CHAR" nullValue=""/>
		<result property="TGL_INVOICE" column="TGL_INVOICE" javaType="date" jdbcType="DATE" />  
		<result property="TGL_BAYAR" column="TGL_BAYAR" javaType="date" jdbcType="DATE" /> 
		<result property="JUMLAH_INVOICE" column="JUMLAH_INVOICE" javaType="java.math.BigDecimal" jdbcType="NUMBER" /> 
		<result property="JUMLAH_BAYAR" column="JUMLAH_BAYAR" javaType="java.math.BigDecimal" jdbcType="NUMBER" />
		<result property="NOMOR" column="NOMOR" javaType="java.math.BigDecimal" jdbcType="NUMBER" />
		<result property="LKU_ID" column="LKU_ID" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="EMAIL" column="EMAIL" javaType="string" jdbcType="VARCHAR2" nullValue=""/>   
	</resultMap>
	
  <select id="elions.worksite.selectCompanyWsList" resultMap="elions.worksite.selectCompanyWsMap" parameterClass="java.util.HashMap" >
  select b.mcl_first,a.mcl_id, a.periode, trunc(a.tgl_invoice) tgl_invoice, trunc(a.tgl_bayar) tgl_bayar, a.jumlah_invoice, a.jumlah_bayar, a.nomor, a.lku_id, c.email 
        from eka.mst_company_ws a,
        eka.mst_client b,
        eka.mst_company_contact c
        where a.mcl_id = b.mcl_id
        and a.mcl_id = c.mcl_id
        and b.mcl_id = c.mcl_id
		<isNotNull property="mcl_id">
		and a.mcl_id = #mcl_id#
		</isNotNull>
		 <isEqual property="jenis" compareValue="1">
         and a.tgl_invoice+15 <![CDATA[<=]]> sysdate
		 and a.tgl_bayar is null
       </isEqual>
         <isEqual property="jenis" compareValue="2">
         and a.tgl_bayar is null
       </isEqual>
         <isEqual property="jenis" compareValue="3">
         and a.tgl_bayar is not null
       </isEqual>
		order by a.periode desc
	</select>	
	
	<select id="elions.worksite.select_nama_perusahaan" resultMap="elions.worksite.select_nama_perusahaan1" parameterClass="java.util.HashMap" >
		SELECT   c.mcl_id, c.mcl_first
		    FROM eka.mst_policy b, eka.mst_insured a, eka.mst_client c
		   WHERE b.lstb_id = 1
		     AND b.reg_spaj = a.reg_spaj
		     AND a.mste_flag_cc = 3
		     AND b.mspo_customer = c.mcl_id
		GROUP BY c.mcl_id, c.mcl_first
		ORDER BY c.mcl_first
	</select>	
	
	<select id="elions.worksite.select_nama_perusahaan_by_mcl_id" resultMap="elions.worksite.select_nama_perusahaan1" parameterClass="java.util.HashMap" >
		SELECT   c.mcl_id, c.mcl_first
		    FROM eka.mst_policy b, eka.mst_insured a, eka.mst_client c
		   WHERE b.lstb_id = 1
		     AND b.reg_spaj = a.reg_spaj
		     AND a.mste_flag_cc = 3
		     AND b.mspo_customer = c.mcl_id
		     AND c.mcl_id = #mcl_id#
		GROUP BY c.mcl_id, c.mcl_first
		ORDER BY c.mcl_first
	</select>	
	
	<select id="elions.worksite.select_nama_perusahaan_by_filter" resultMap="elions.worksite.select_nama_perusahaan1" parameterClass="java.util.HashMap" >
		SELECT   c.mcl_id, c.mcl_first
            FROM eka.mst_policy b, eka.mst_insured a, eka.mst_client c , eka.mst_company d
           WHERE b.lstb_id = 1
             AND b.reg_spaj = a.reg_spaj
             AND b.mspo_customer = c.mcl_id
             AND c.mcl_id = d.mcl_id
             AND D.flag_grup_sinarmas=#kode#
        GROUP BY c.mcl_id, c.mcl_first
        ORDER BY c.mcl_first
	</select>	
	
	<resultMap id="elions.worksite.select_invoice1" class="java.util.HashMap">
		<result property="REG_SPAJ" column="REG_SPAJ" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                  
		<result property="MSPO_CUSTOMER" column="MSPO_CUSTOMER" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="NO_INVOICE" column="NO_INVOICE" javaType="string" jdbcType="CHAR" nullValue=""/>
		<result property="SUB_ID" column="SUB_ID" javaType="string" jdbcType="NUMBER" nullValue=""/> 
	</resultMap>
	
	<select id="elions.worksite.select_invoice" resultMap="elions.worksite.select_invoice1"  parameterClass="java.util.HashMap">
SELECT distinct "MST_PRODUCT_INSURED"."REG_SPAJ", 
      			 "MST_POLICY"."MSPO_CUSTOMER","MST_INSURED"."NO_INVOICE",
				 "MST_POSITION_SPAJ"."SUB_ID"
           FROM "EKA"."MST_POLICY" "MST_POLICY",
                "EKA"."MST_INSURED" "MST_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_2",
                "EKA"."MST_COMPANY" "MST_COMPANY",
                "EKA"."MST_WORKSITE_FLAG" "MST_WORKSITE_FLAG",
                "EKA"."MST_ADDRESS_NEW" "MST_ADDRESS_NEW",
                "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_1",
                "EKA"."MST_AGENT_PROD" "MST_AGENT_PROD",
                "EKA"."LST_DET_BISNIS" "LST_DET_BISNIS",
                "EKA"."MST_AGENT" "MST_AGENT",
				"EKA"."MST_POSITION_SPAJ" "MST_POSITION_SPAJ",
				"EKA"."LST_STATUS_ACCEPT_SUB" "LST_STATUS_ACCEPT_SUB"
          WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
            AND ("MST_POLICY"."MSPO_POLICY_HOLDER" = "MST_CLIENT_NEW"."MCL_ID")
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_CLIENT_NEW_2"."MCL_ID"(+))
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_COMPANY"."MCL_ID"(+))
            AND ("MST_POLICY"."REG_SPAJ" = "MST_WORKSITE_FLAG"."REG_SPAJ"(+))
			AND ("MST_POLICY"."REG_SPAJ" = "MST_POSITION_SPAJ"."REG_SPAJ")
			AND ("MST_POLICY"."LSSP_ID" = "MST_POSITION_SPAJ"."LSSP_ID")
			AND ("MST_POLICY"."LSPD_ID" = "MST_POSITION_SPAJ"."LSPD_ID")
            AND ("MST_CLIENT_NEW_2"."MCL_ID" = "MST_ADDRESS_NEW"."MCL_ID")
            AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
                 AND ("MST_INSURED"."MSTE_INSURED_NO" = "MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
            AND ("MST_INSURED"."MSTE_INSURED" = "MST_CLIENT_NEW_1"."MCL_ID")
			AND ("MST_INSURED"."LSSA_ID" = "MST_POSITION_SPAJ"."LSSA_ID")
            AND ("MST_PRODUCT_INSURED"."REG_SPAJ" ="MST_AGENT_PROD"."REG_SPAJ")
            AND ( ("MST_PRODUCT_INSURED"."LSBS_ID" = "LST_DET_BISNIS"."LSBS_ID")
                 AND ("MST_PRODUCT_INSURED"."LSDBS_NUMBER" = "LST_DET_BISNIS"."LSDBS_NUMBER"))
            AND ("MST_AGENT_PROD"."MSAG_ID" = "MST_AGENT"."MSAG_ID")
			AND ("MST_POSITION_SPAJ"."MSPS_DATE" = (SELECT MAX("MSPS_DATE") FROM EKA.MST_POSITION_SPAJ WHERE REG_SPAJ = "MST_POLICY"."REG_SPAJ") )
            AND "MST_INSURED"."MSTE_FLAG_CC" = 3
            AND "MST_POLICY"."LSPD_ID" in (1,2)
            AND "MST_POLICY"."LSTB_ID" = 1
            AND "MST_POLICY"."MSPO_CUSTOMER" =#id#
            AND "MST_AGENT"."LCA_ID" = '42'
            AND "MST_AGENT_PROD"."LSLE_ID" = 4 
			AND "MST_PRODUCT_INSURED"."LSBS_ID" <![CDATA[<]]> 300 
			AND "MST_INSURED"."LSSA_ID" in( 1,3,9 )
			AND ("MST_POSITION_SPAJ"."SUB_ID" <![CDATA[<]]> 2 or "MST_POSITION_SPAJ"."SUB_ID" is null )
			AND "MST_POLICY"."REG_SPAJ" not in (SELECT REG_SPAJ FROM EKA.MST_DEPOSIT_PREMIUM)
	</select>

	<resultMap id="elions.worksite.select_invoice2" class="java.util.HashMap">
		<result property="REG_SPAJ" column="REG_SPAJ" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                  
		<result property="MSPO_CUSTOMER" column="MSPO_CUSTOMER" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="NO_INVOICE" column="NO_INVOICE" javaType="string" jdbcType="CHAR" nullValue=""/>
	</resultMap>
	
	<select id="elions.worksite.select_invoice_lanjutan" resultMap="elions.worksite.select_invoice2"  parameterClass="java.util.HashMap">
		SELECT distinct "MST_PRODUCT_INSURED"."REG_SPAJ", 
      			 "MST_POLICY"."MSPO_CUSTOMER","MST_INSURED"."NO_INVOICE"
           FROM "EKA"."MST_POLICY" "MST_POLICY",
                "EKA"."MST_INSURED" "MST_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_2",
                "EKA"."MST_COMPANY" "MST_COMPANY",
                "EKA"."MST_WORKSITE_FLAG" "MST_WORKSITE_FLAG",
                "EKA"."MST_ADDRESS_NEW" "MST_ADDRESS_NEW",
                "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_1",
                "EKA"."MST_AGENT_PROD" "MST_AGENT_PROD",
                "EKA"."LST_DET_BISNIS" "LST_DET_BISNIS",
                "EKA"."MST_AGENT" "MST_AGENT"
          WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
            AND ("MST_POLICY"."MSPO_POLICY_HOLDER" = "MST_CLIENT_NEW"."MCL_ID")
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_CLIENT_NEW_2"."MCL_ID"(+))
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_COMPANY"."MCL_ID"(+))
            AND ("MST_POLICY"."REG_SPAJ" = "MST_WORKSITE_FLAG"."REG_SPAJ"(+))
            AND ("MST_CLIENT_NEW_2"."MCL_ID" = "MST_ADDRESS_NEW"."MCL_ID")
            AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
                 AND ("MST_INSURED"."MSTE_INSURED_NO" = "MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
            AND ("MST_INSURED"."MSTE_INSURED" = "MST_CLIENT_NEW_1"."MCL_ID")
            AND ("MST_PRODUCT_INSURED"."REG_SPAJ" ="MST_AGENT_PROD"."REG_SPAJ")
            AND ( ("MST_PRODUCT_INSURED"."LSBS_ID" = "LST_DET_BISNIS"."LSBS_ID")
                 AND ("MST_PRODUCT_INSURED"."LSDBS_NUMBER" = "LST_DET_BISNIS"."LSDBS_NUMBER"))
            AND ("MST_AGENT_PROD"."MSAG_ID" = "MST_AGENT"."MSAG_ID")
            AND "MST_INSURED"."MSTE_FLAG_CC" = 3
            AND "MST_POLICY"."LSPD_ID" = 6
            AND "MST_POLICY"."LSTB_ID" = 1
            AND "MST_AGENT"."LCA_ID" = '42'
            AND "MST_AGENT_PROD"."LSLE_ID" = 4 
			AND "MST_PRODUCT_INSURED"."LSBS_ID"  <![CDATA[<]]> 300 
			AND "MST_INSURED"."LSSA_ID" = 5	
			AND "MST_POLICY"."MSPO_CUSTOMER" =#id#
	</select>	
	
		
	<resultMap id="elions.worksite.select_invoice_endow1" class="java.util.HashMap">
		<result property="REG_SPAJ" column="REG_SPAJ" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                  
		<result property="MSPO_CUSTOMER" column="MSPO_CUSTOMER" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="NO_INVOICE" column="NO_INVOICE" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="LCA_ID" column="LCA_ID" javaType="string" jdbcType="CHAR" nullValue=""/> 
	</resultMap>
	
	<select id="elions.worksite.select_invoice_endow" resultMap="elions.worksite.select_invoice_endow1"  parameterClass="java.util.HashMap">
			SELECT distinct "MST_PRODUCT_INSURED"."REG_SPAJ", 
			      			 "MST_POLICY"."MSPO_CUSTOMER","MST_INSURED"."NO_INVOICE","MST_POLICY"."LCA_ID"
			  FROM "EKA"."MST_POLICY" "MST_POLICY",
			       "EKA"."MST_INSURED" "MST_INSURED",
			       "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED"
			 WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
			   AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
			        AND ("MST_INSURED"."MSTE_INSURED_NO" ="MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
			   AND (    (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[>=]]> #tgl1#
			        AND (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[<=]]>  #tgl2#)
			   AND "MST_POLICY"."LSTB_ID" = 1
			   AND "MST_POLICY"."MSPO_CUSTOMER" = #id#
			   AND "MST_PRODUCT_INSURED"."LSBS_ID" = 157
	</select>
	
		<select id="elions.worksite.select_invoice_endow_perspaj" resultMap="elions.worksite.select_invoice_endow1"  parameterClass="java.util.HashMap">
			SELECT distinct "MST_PRODUCT_INSURED"."REG_SPAJ", 
			      			 "MST_POLICY"."MSPO_CUSTOMER","MST_INSURED"."NO_INVOICE","MST_POLICY"."LCA_ID"
			  FROM "EKA"."MST_POLICY" "MST_POLICY",
			       "EKA"."MST_INSURED" "MST_INSURED",
			       "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED"
			 WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
			   AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
			        AND ("MST_INSURED"."MSTE_INSURED_NO" ="MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
			   AND "MST_POLICY"."LSTB_ID" = 1
			    AND ( "MST_POLICY"."REG_SPAJ"= rpad(replace(#id# ,'.'),11,' ') )
			   AND "MST_PRODUCT_INSURED"."LSBS_ID" = 157
	</select>
	
	<resultMap id="elions.worksite.select_kwitansi_endow1" class="java.util.HashMap">
		<result property="REG_SPAJ" column="REG_SPAJ" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                  
	</resultMap>
	
	<select id="elions.worksite.select_kwitansi_endow" resultMap="elions.worksite.select_kwitansi_endow1"  parameterClass="java.util.HashMap">
		SELECT "MST_POLICY"."REG_SPAJ"
		  FROM "EKA"."MST_POLICY" "MST_POLICY",
		       "EKA"."MST_INSURED" "MST_INSURED",
		       "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED"
		 WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
		   AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
		        AND ("MST_INSURED"."MSTE_INSURED_NO" ="MST_PRODUCT_INSURED"."MSTE_INSURED_NO" ) )
		   AND "MST_PRODUCT_INSURED"."LSBS_ID" = 157
		   AND "MST_POLICY"."LSTB_ID" = 1
		   AND (    (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[>=]]> #tgl1#
		        AND (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd'))<![CDATA[<=]]>  #tgl2# )
		   AND "MST_POLICY"."MSPO_CUSTOMER" =#id#
	</select>	
	
	<resultMap id="elions.worksite.select_max_invoice1" class="java.util.HashMap">
		<result property="MAXIMUM" column="MAXIMUM" javaType="string" jdbcType="CHAR" nullValue=""/> 
	</resultMap>
	
	<select id="elions.worksite.select_max_invoice" resultMap="elions.worksite.select_max_invoice1"  parameterClass="java.util.HashMap">
	SELECT MAX("MST_INSURED"."NO_INVOICE") "MAXIMUM"
           FROM "EKA"."MST_POLICY" "MST_POLICY",
                "EKA"."MST_INSURED" "MST_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_2",
                "EKA"."MST_COMPANY" "MST_COMPANY",
                "EKA"."MST_WORKSITE_FLAG" "MST_WORKSITE_FLAG",
                "EKA"."MST_ADDRESS_NEW" "MST_ADDRESS_NEW",
                "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_1",
                "EKA"."MST_AGENT_PROD" "MST_AGENT_PROD",
                "EKA"."LST_DET_BISNIS" "LST_DET_BISNIS",
                "EKA"."MST_AGENT" "MST_AGENT"
          WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
            AND ("MST_POLICY"."MSPO_POLICY_HOLDER" = "MST_CLIENT_NEW"."MCL_ID")
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_CLIENT_NEW_2"."MCL_ID"(+))
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_COMPANY"."MCL_ID"(+))
            AND ("MST_POLICY"."REG_SPAJ" = "MST_WORKSITE_FLAG"."REG_SPAJ"(+))
            AND ("MST_CLIENT_NEW_2"."MCL_ID" = "MST_ADDRESS_NEW"."MCL_ID")
            AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
                 AND ("MST_INSURED"."MSTE_INSURED_NO" = "MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
            AND ("MST_INSURED"."MSTE_INSURED" = "MST_CLIENT_NEW_1"."MCL_ID")
            AND ("MST_PRODUCT_INSURED"."REG_SPAJ" ="MST_AGENT_PROD"."REG_SPAJ")
            AND ( ("MST_PRODUCT_INSURED"."LSBS_ID" = "LST_DET_BISNIS"."LSBS_ID")
                 AND ("MST_PRODUCT_INSURED"."LSDBS_NUMBER" = "LST_DET_BISNIS"."LSDBS_NUMBER"))
            AND ("MST_AGENT_PROD"."MSAG_ID" = "MST_AGENT"."MSAG_ID")
            AND "MST_INSURED"."MSTE_FLAG_CC" = 3
            AND "MST_POLICY"."LSPD_ID" = 1
            AND "MST_POLICY"."LSTB_ID" = 1
            AND "MST_POLICY"."MSPO_CUSTOMER" =#id#
            AND "MST_AGENT"."LCA_ID" = '42'
            AND "MST_AGENT_PROD"."LSLE_ID" = 4 
			AND "MST_PRODUCT_INSURED"."LSBS_ID" <![CDATA[<]]> 300 
			AND "MST_INSURED"."LSSA_ID" = 1
	</select>	
	
	<select id="elions.worksite.select_max_invoice_lanjutan" resultMap="elions.worksite.select_max_invoice1"  parameterClass="java.util.HashMap">
	SELECT MAX("MST_INSURED"."NO_INVOICE") "MAXIMUM"
           FROM "EKA"."MST_POLICY" "MST_POLICY",
                "EKA"."MST_INSURED" "MST_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_2",
                "EKA"."MST_COMPANY" "MST_COMPANY",
                "EKA"."MST_WORKSITE_FLAG" "MST_WORKSITE_FLAG",
                "EKA"."MST_ADDRESS_NEW" "MST_ADDRESS_NEW",
                "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED",
                "EKA"."MST_CLIENT_NEW" "MST_CLIENT_NEW_1",
                "EKA"."MST_AGENT_PROD" "MST_AGENT_PROD",
                "EKA"."LST_DET_BISNIS" "LST_DET_BISNIS",
                "EKA"."MST_AGENT" "MST_AGENT"
          WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
            AND ("MST_POLICY"."MSPO_POLICY_HOLDER" = "MST_CLIENT_NEW"."MCL_ID")
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_CLIENT_NEW_2"."MCL_ID"(+))
            AND ("MST_POLICY"."MSPO_CUSTOMER" = "MST_COMPANY"."MCL_ID"(+))
            AND ("MST_POLICY"."REG_SPAJ" = "MST_WORKSITE_FLAG"."REG_SPAJ"(+))
            AND ("MST_CLIENT_NEW_2"."MCL_ID" = "MST_ADDRESS_NEW"."MCL_ID")
            AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
                 AND ("MST_INSURED"."MSTE_INSURED_NO" = "MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
            AND ("MST_INSURED"."MSTE_INSURED" = "MST_CLIENT_NEW_1"."MCL_ID")
            AND ("MST_PRODUCT_INSURED"."REG_SPAJ" ="MST_AGENT_PROD"."REG_SPAJ")
            AND ( ("MST_PRODUCT_INSURED"."LSBS_ID" = "LST_DET_BISNIS"."LSBS_ID")
                 AND ("MST_PRODUCT_INSURED"."LSDBS_NUMBER" = "LST_DET_BISNIS"."LSDBS_NUMBER"))
            AND ("MST_AGENT_PROD"."MSAG_ID" = "MST_AGENT"."MSAG_ID")
            AND "MST_INSURED"."MSTE_FLAG_CC" = 3
            AND "MST_POLICY"."LSPD_ID" = 1
            AND "MST_POLICY"."LSTB_ID" = 1
            AND "MST_POLICY"."MSPO_CUSTOMER" =#id#
            AND "MST_AGENT"."LCA_ID" = '42'
            AND "MST_AGENT_PROD"."LSLE_ID" = 4 
			AND "MST_PRODUCT_INSURED"."LSBS_ID" <![CDATA[<]]> 300 
			AND "MST_INSURED"."LSSA_ID" = 1
	</select>
	
	<resultMap id="elions.worksite.select_max_invoice_endow1" class="java.util.HashMap">
		<result property="MAXIMUM" column="MAXIMUM" javaType="string" jdbcType="CHAR" nullValue=""/> 
	</resultMap>
	
	<select id="elions.worksite.select_max_invoice_endow" resultMap="elions.worksite.select_max_invoice_endow1"  parameterClass="java.util.HashMap">
		SELECT MAX("MST_INSURED"."NO_INVOICE") "MAXIMUM"
		  FROM "EKA"."MST_POLICY" "MST_POLICY",
		       "EKA"."MST_INSURED" "MST_INSURED",
		       "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED"
		 WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
		   AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
		        AND ("MST_INSURED"."MSTE_INSURED_NO" ="MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
		   AND (    (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[>=]]> #tgl1#
		        AND (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[<=]]> #tgl2#)
		   AND "MST_POLICY"."LSTB_ID" = 1
		   AND "MST_POLICY"."MSPO_CUSTOMER" = #id#
		   AND "MST_PRODUCT_INSURED"."LSBS_ID" = 157
	</select>	
	
	<select id="elions.worksite.select_max_invoice_endow_perspaj" resultMap="elions.worksite.select_max_invoice_endow1"  parameterClass="java.util.HashMap">
		   		SELECT MAX("MST_INSURED"."NO_INVOICE") "MAXIMUM"
		  FROM "EKA"."MST_POLICY" "MST_POLICY",
		       "EKA"."MST_INSURED" "MST_INSURED",
		       "EKA"."MST_PRODUCT_INSURED" "MST_PRODUCT_INSURED"
		 WHERE ("MST_POLICY"."REG_SPAJ" = "MST_INSURED"."REG_SPAJ")
		   AND (    ("MST_INSURED"."REG_SPAJ" = "MST_PRODUCT_INSURED"."REG_SPAJ")
		        AND ("MST_INSURED"."MSTE_INSURED_NO" ="MST_PRODUCT_INSURED"."MSTE_INSURED_NO"))
		   AND "MST_POLICY"."LSTB_ID" = 1
		    AND ( "MST_POLICY"."REG_SPAJ"= rpad(replace(#id# ,'.'),11,' ') )
		   AND "MST_PRODUCT_INSURED"."LSBS_ID" = 157
	</select>	
	
	<select id="elions.worksite.select_counter_invoice" resultClass="long" parameterClass="java.util.HashMap">
		SELECT "EKA"."MST_COUNTER"."MSCO_VALUE"
		FROM "EKA"."MST_COUNTER"
		WHERE "EKA"."MST_COUNTER"."MSCO_NUMBER"=#no# AND
		"EKA"."MST_COUNTER"."LCA_ID"=#kode# FOR UPDATE
	</select>

	<resultMap id="elions.worksite.select_billing1" class="java.util.HashMap">
		<result property="MSBI_BILL_NO" column="MSBI_BILL_NO" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                          
		<result property="LCA_ID" column="LCA_ID" javaType="string" jdbcType="CHAR" nullValue=""/>                                                                                                                                                      
		<result property="REG_SPAJ" column="REG_SPAJ" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="MSTE_FLAG_CC" column="MSTE_FLAG_CC" javaType="int" jdbcType="NUMBER" />
	</resultMap>
	
	<select id="elions.worksite.select_billing" resultMap="elions.worksite.select_billing1" parameterClass="java.util.HashMap">
		SELECT EKA.MST_BILLING.MSBI_BILL_NO,
		EKA.MST_BILLING.LCA_ID,
		EKA.MST_BILLING.REG_SPAJ,
		EKA.MST_INSURED.MSTE_FLAG_CC
		FROM EKA.MST_BILLING,
		EKA.MST_INSURED
		WHERE EKA.MST_BILLING.REG_SPAJ =  rpad(replace(#spaj# ,'.'),11,' ') 
		AND EKA.MST_BILLING.MSBI_PREMI_KE = #ke#
		AND EKA.MST_BILLING.REG_SPAJ = EKA.MST_INSURED.REG_SPAJ
		AND EKA.MST_INSURED.MSTE_FLAG_CC = 3
	</select>
	
	<select id="elions.worksite.select_billing_endow_spaj" resultMap="elions.worksite.select_billing1" parameterClass="java.util.HashMap">
		SELECT EKA.MST_BILLING.MSBI_BILL_NO,
		EKA.MST_BILLING.LCA_ID,
		EKA.MST_BILLING.REG_SPAJ,
		EKA.MST_INSURED.MSTE_FLAG_CC
		FROM EKA.MST_BILLING,
		EKA.MST_INSURED
		WHERE EKA.MST_BILLING.REG_SPAJ =  rpad(replace(#spaj# ,'.'),11,' ') 
		AND EKA.MST_BILLING.MSBI_PREMI_KE = #ke#
		AND EKA.MST_BILLING.REG_SPAJ = EKA.MST_INSURED.REG_SPAJ
	</select>

	<select id="elions.worksite.select_billing_endow" resultMap="elions.worksite.select_billing1" parameterClass="java.util.HashMap">
	  SELECT EKA.MST_BILLING.MSBI_BILL_NO,
		EKA.MST_BILLING.LCA_ID,
		EKA.MST_BILLING.REG_SPAJ,
		 1 MSTE_FLAG_CC
    FROM "EKA"."MST_BILLING",   
         "EKA"."MST_POLICY",   
         "EKA"."MST_PRODUCT_INSURED",
		 "EKA"."MST_INSURED"
   WHERE ( EKA.MST_POLICY.REG_SPAJ= EKA.MST_BILLING.REG_SPAJ) and  
   		 ( "EKA"."MST_POLICY"."REG_SPAJ" = "EKA"."MST_INSURED"."REG_SPAJ") AND
		 		 ( "EKA"."MST_INSURED"."REG_SPAJ" = "EKA"."MST_PRODUCT_INSURED"."REG_SPAJ") AND
		 ("EKA"."MST_INSURED"."MSTE_INSURED_NO" = "EKA"."MST_PRODUCT_INSURED"."MSTE_INSURED_NO") AND
		 (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd'))<![CDATA[>=]]> #tgl1# AND
		 (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[<=]]> #tgl2# AND
		 "EKA"."MST_POLICY"."LSTB_ID" = 1 AND
		  ( EKA."MST_BILLING"."MSBI_PREMI_KE" =  #ke# ) AND  
         ( EKA."MST_POLICY"."MSPO_CUSTOMER" =   #kode# ) AND  
         ( EKA."MST_PRODUCT_INSURED"."LSBS_ID" = #bisnis# ) 
	</select>

	<select id="elions.worksite.select_max_billing_endow" resultMap="elions.worksite.select_max_invoice_endow1" parameterClass="java.util.HashMap">
	  SELECT max(EKA.MST_BILLING.MSBI_BILL_NO)"MAXIMUM"
    FROM "EKA"."MST_BILLING",   
         "EKA"."MST_POLICY",   
         "EKA"."MST_PRODUCT_INSURED",
		 "EKA"."MST_INSURED"
   WHERE ( EKA.MST_POLICY.REG_SPAJ= EKA.MST_BILLING.REG_SPAJ) and  
   		 ( "EKA"."MST_POLICY"."REG_SPAJ" = "EKA"."MST_INSURED"."REG_SPAJ") AND
		 		 ( "EKA"."MST_INSURED"."REG_SPAJ" = "EKA"."MST_PRODUCT_INSURED"."REG_SPAJ") AND
		 ("EKA"."MST_INSURED"."MSTE_INSURED_NO" = "EKA"."MST_PRODUCT_INSURED"."MSTE_INSURED_NO") AND
		 (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[>=]]> #tgl1# AND
		 (TO_CHAR ("MST_INSURED"."MSTE_TGL_AKSEP", 'yyyymmdd')) <![CDATA[<=]]> #tgl2# AND
		 "EKA"."MST_POLICY"."LSTB_ID" = 1 AND
		 ( EKA."MST_BILLING"."MSBI_PREMI_KE" =  #ke# ) AND  
         ( EKA."MST_POLICY"."MSPO_CUSTOMER" =  #kode# ) AND  
         ( EKA."MST_PRODUCT_INSURED"."LSBS_ID" = #bisnis#  ) 
	</select>
					
	<select id="elions.worksite.selectHistoryUT" resultClass="java.util.HashMap" parameterClass="java.util.Map">
        select
            a.no, a.periode, to_char( create_date, 'dd/mm/yyyy' ) process_date, nvl( b.lus_full_name, 'System' ) user_name, a.file_name, a.descr
        from
            eka.mst_history_ut a
        left join
            eka.lst_user b
            on a.lus_id = b.lus_id
        where
            a.MCL_ID = UPPER(#MCL_ID#) and
            a.JENIS = #JENIS# and
            a.REG_SPAJ = UPPER (#REG_SPAJ#) and
            a.TAHUN_KE = #TAHUN_KE# and
            a.PREMI_KE = #PREMI_KE# and
            a.PERIODE between #PERIODE_FROM# and #PERIODE_TO#
        order by a.no
    </select>
    
      <resultMap id="elions.worksite.selectSummaryKomisi" class="java.util.HashMap">
		<result property="MCL_FIRST" column="MCL_FIRST" javaType="string" jdbcType="VARCHAR2" nullValue=""/>    
		<result property="MCL_ID" column="MCL_ID" javaType="string" jdbcType="CHAR" />                                                                                                                                                  
		<result property="PERIODE" column="PERIODE" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="REK_NAMA" column="REK_NAMA" javaType="string" jdbcType="VARCHAR2" />
		<result property="REK_NO" column="REK_NO" javaType="string" jdbcType="VARCHAR2" />
		<result property="BANK_DESCR" column="BANK_DESCR" javaType="string" jdbcType="VARCHAR2" />
		<result property="NOMINAL" column="NOMINAL" javaType="string" jdbcType="VARCHAR2" />
		<result property="NO_PRE" column="NO_PRE" javaType="string" jdbcType="CHAR" />  
		<result property="POSITION" column="POSITION" javaType="int" jdbcType="NUMBER" />
		<result property="MTB_GL_NO" column="MTB_GL_NO" javaType="string" jdbcType="VARCHAR2" />
		<result property="FULL_PERIODE" column="FULL_PERIODE" javaType="string" jdbcType="VARCHAR2" />
		<result property="TAX_NO" column="TAX_NO" javaType="string" jdbcType="VARCHAR2" />
		<result property="PAJAK" column="PAJAK" javaType="string" jdbcType="VARCHAR2" />
		<result property="NETT" column="NETT" javaType="string" jdbcType="VARCHAR2" />
	</resultMap>
    
	   <select id="elions.worksite.selectListSummaryKomisi" resultMap="elions.worksite.selectSummaryKomisi" parameterClass="java.util.Map">
   SELECT /*+ first_rows */
   a.tax_no,
   a.no_pre,
    c.mcl_id,
    c.mcl_first, 
    b.rek_nama,
    d.position,
    d.mtb_gl_no,
    b.rek_no,
    a.jenis_edit_nominal,
    a.user_edit_nominal,
    a.update_date_edit_nominal,
    a.jumlah_edit_nominal,	
    b.rek_bank  || ', ' || b.rek_bank_cabang || ', ' || b.rek_bank_kota bank_descr, 
   (case when(a.no_pre is not null) then min(a.periode) || '-' || max(a.periode) else  
   EKA.PKG_WORKSITE.FN_BEGDATE_KOMISI( a.mcl_id, #periode#) || '-' || #periode#  end) as full_periode ,
    #periode# as periode,
    sum(a.nominal) nominal,
    sum(a.nominal) jumlah,
    (case when(a.no_pre is null) then eka.pkg_worksite.FN_Hitung_Pajak_Worksite(a.mcl_id,#periode#)  else (select sum(jumlah) from eka.mst_dbank where a.no_pre = no_pre and keterangan = 'PAJAK') end) pajak,
    (case when(a.no_pre is null) then (sum(a.nominal) - eka.pkg_worksite.FN_Hitung_Pajak_Worksite(a.mcl_id,#periode#)) else  (sum(a.nominal) - (select jumlah from eka.mst_dbank where a.no_pre = no_pre and keterangan = 'PAJAK')) end) nett
FROM eka.mst_diskon_perusahaan a, eka.mst_company_contact b, eka.mst_client c , eka.mst_tbank d    
WHERE 
a.jenis = 1
AND b.no_urut = 1
AND a.flag_bayar = 0
AND a.flag_aktif = 1
AND a.flag_perintah_bayar = 1
AND a.periode <![CDATA[<=]]> #periode#
<isNotNull property="bank">
AND b.rek_bank LIKE (TRIM ('%' || UPPER(#bank#) || '%'))	
</isNotNull>
<isNotNull property="nama">
AND c.mcl_first LIKE (TRIM ('%' || UPPER(#nama#) || '%')) 	
</isNotNull>
AND a.mcl_id = b.mcl_id
AND a.mcl_id = c.mcl_id
AND a.no_pre = d.no_pre(+)
<isEqual property="transfer" compareValue="1">
AND a.no_pre is not null
</isEqual>
<isEqual property="transfer" compareValue="2">
AND a.no_pre is null
</isEqual>
GROUP BY 
	a.tax_no,
	a.no_pre,
    c.mcl_id,
    c.mcl_first,
    b.rek_nama,
     d.mtb_gl_no,
     d.position,
    b.rek_no, 
    b.rek_bank  || ', ' || b.rek_bank_cabang || ', ' || b.rek_bank_kota,
    a.mcl_id,
    a.jenis_edit_nominal,
    a.user_edit_nominal,
    a.update_date_edit_nominal,
    a.jumlah_edit_nominal
    </select>
    
     <resultMap id="elions.worksite.selectSummaryKomisiForPrint" class="java.util.HashMap">
		<result property="MCL_FIRST" column="MCL_FIRST" javaType="string" jdbcType="VARCHAR2" nullValue=""/>    
		<result property="MCL_ID" column="MCL_ID" javaType="string" jdbcType="CHAR" />                                                                                                                                                  
		<result property="PERIODE" column="PERIODE" javaType="string" jdbcType="CHAR" nullValue=""/> 
		<result property="REK_NAMA" column="REK_NAMA" javaType="string" jdbcType="VARCHAR2" />
		<result property="REK_NO" column="REK_NO" javaType="string" jdbcType="VARCHAR2" />
		<result property="BANK_DESCR" column="BANK_DESCR" javaType="string" jdbcType="VARCHAR2" />
		<result property="NOMINAL" column="NOMINAL" javaType="string" jdbcType="VARCHAR2" />
		<result property="NO_PRE" column="NO_PRE" javaType="string" jdbcType="CHAR" />  
		<result property="POSITION" column="POSITION" javaType="int" jdbcType="NUMBER" />
		<result property="MTB_GL_NO" column="MTB_GL_NO" javaType="string" jdbcType="VARCHAR2" />
		<result property="FULL_PERIODE" column="FULL_PERIODE" javaType="string" jdbcType="VARCHAR2" />
		<result property="TAX_NO" column="TAX_NO" javaType="string" jdbcType="VARCHAR2" />
		<result property="PAJAK" column="PAJAK" javaType="string" jdbcType="VARCHAR2" />
		<result property="NETT" column="NETT" javaType="string" jdbcType="VARCHAR2" />
		<result property="JUMLAH_NOMINAL" column="JUMLAH_NOMINAL" javaType="string" jdbcType="NUMBER" />
		<result property="JUMLAH_PAJAK" column="JUMLAH_PAJAK" javaType="string" jdbcType="NUMBER" />
	</resultMap>
	
      <select id="elions.worksite.selectListSummaryKomisiForPrint" resultMap="elions.worksite.selectSummaryKomisiForPrint" parameterClass="java.util.Map">
   SELECT /*+ first_rows */
   a.tax_no,
   a.no_pre,
    c.mcl_id,
    c.mcl_first, 
    b.rek_nama,
    d.position,
    d.mtb_gl_no,
    b.rek_no,
    b.rek_bank  || ', ' || b.rek_bank_cabang || ', ' || b.rek_bank_kota bank_descr, 
   (case when(a.no_pre is not null) then min(a.periode) || '-' || max(a.periode) else  
   EKA.PKG_WORKSITE.FN_BEGDATE_KOMISI( a.mcl_id, #periode#) || '-' || #periode#  end) as full_periode ,
    #periode# as periode,
    sum(a.nominal) jumlah_nominal,
    'Rp.'||to_char(sum(a.nominal),'999,999,999,999,999.00') nominal,
    'Rp.'||to_char((select sum(jumlah) from eka.mst_dbank where a.no_pre = no_pre and keterangan = 'PAJAK'),'999,999,999,999,999.00') pajak,
    'Rp.'||to_char((sum(a.nominal) - (select jumlah from eka.mst_dbank where a.no_pre = no_pre and keterangan = 'PAJAK')),'999,999,999,999,999.00') nett,
       (select sum(jumlah) from eka.mst_dbank where a.no_pre = no_pre and keterangan = 'PAJAK') jumlah_pajak
FROM eka.mst_diskon_perusahaan a, eka.mst_company_contact b, eka.mst_client c , eka.mst_tbank d    
WHERE 
a.jenis = 1
AND b.no_urut = 1
AND a.flag_bayar = 0
AND a.flag_aktif = 1
AND a.flag_perintah_bayar = 1
AND a.periode <![CDATA[<=]]> #periode#
<isNotNull property="bank">
AND b.rek_bank LIKE (TRIM ('%' || UPPER(#bank#) || '%'))	
</isNotNull>
AND a.mcl_id = b.mcl_id
AND a.mcl_id = c.mcl_id
AND a.no_pre = d.no_pre(+)
AND a.no_pre is not null
GROUP BY 
	a.tax_no,
	a.no_pre,
    c.mcl_id,
    c.mcl_first,
    b.rek_nama,
     d.mtb_gl_no,
     d.position,
    b.rek_no, 
    b.rek_bank  || ', ' || b.rek_bank_cabang || ', ' || b.rek_bank_kota,
    a.mcl_id
    </select>
    
    <select id="elions.worksite.selectInfoDBankForJurnal" resultClass="java.util.HashMap" parameterClass="java.util.Map">
    select * from eka.mst_dbank where no_pre = #no_pre#
    </select>
					
	<select id="elions.worksite.selectBankForJurnal" resultClass="java.util.HashMap">
		select distinct ( c.lsbp_nama||', '|| b.lbn_nama ) as bank, a.lsrek_gl_no as id
		from 
		   eka.lst_rek_ekalife a, eka.lst_bank b, eka.lst_bank_pusat c
		where 
		c.flag_aktif = 1 
		and b.flag_aktif = 1
		and a.lsrek_aktif = 1
		and a.lsrek_id in ( 18,177 )
		and a.lbn_id = b.lbn_id(+)
		and b.lsbp_id = c.lsbp_id(+)
	</select>			

<select id="elions.worksite.selectJenisBdnDanNpwp" resultClass="java.util.HashMap" parameterClass="java.util.Map">
select decode(jenis_badan, 1, 'INDV', 2, 'PRSH', null ) jenis, npwp
   from eka.mst_company_contact 
   where no_urut = 1 
   and mcl_id = #mcl_id#
</select>

    <select id="elions.worksite.selectMaxPeriodeMstDiskonPerusahaan" resultClass="java.lang.String" parameterClass="java.util.Map">
        select periode
        from
        eka.mst_diskon_perusahaan
        where
            MCL_ID = UPPER(#MCL_ID#) and
            JENIS = #JENIS# and
            REG_SPAJ = UPPER (#REG_SPAJ#) and
            TAHUN_KE = #TAHUN_KE# and
            PREMI_KE = #PREMI_KE#
            and rownum = 1
            order by periode desc
    </select>

    <select id="elions.worksite.selectMaxNoMstHistoryUT" resultClass="java.lang.Integer" parameterClass="java.util.Map">
        select max( no ) max_no
        from eka.mst_history_ut
        where
            MCL_ID = UPPER(#MCL_ID#) and
            JENIS = #JENIS# and
            REG_SPAJ = UPPER (#REG_SPAJ#) and
            TAHUN_KE = #TAHUN_KE# and
            PREMI_KE = #PREMI_KE#
    </select>
    
    <select id="elions.worksite.selectMaxNomorCompanyWs" resultClass="java.math.BigDecimal" parameterClass="java.util.Map">
    select max(nomor) nomor from eka.mst_company_ws where mcl_id = #mcl_id#
and
periode = #periode# 
  </select>
        <select id="elions.worksite.selectNettDiskonPerusahaan" resultClass="java.math.BigDecimal" parameterClass="java.util.Map">
    select #nominal# - (case when( sum(jumlah) is not null) then  sum(jumlah) else eka.pkg_worksite.FN_Hitung_Pajak_Worksite(#mcl_id#,#periode#) end ) as nett
    from eka.mst_dbank where keterangan = 'PAJAK' and no_pre = #no_pre#
    </select>
    
            <select id="elions.worksite.selectPajakDiskonPerusahaan" resultClass="java.math.BigDecimal" parameterClass="java.util.Map">
    select (case when( sum(jumlah) is not null) then  sum(jumlah) else eka.pkg_worksite.FN_Hitung_Pajak_Worksite(#mcl_id#,#periode#) end ) as pajak
    from eka.mst_dbank where keterangan = 'PAJAK' and no_pre = #no_pre#
    </select>
    
 <select id="elions.worksite.selectDetailUpdateJurnalDiskonPerusahaan" resultClass="java.util.HashMap" parameterClass="java.util.Map">
    select decode(a.jenis_edit_nominal, 1, 'Kelebihan Bayar', 2, 'Kekurangan Bayar') jenis_update, to_char(update_date_edit_nominal,'dd mon yyyy') tanggal_update,
b.lus_full_name nama, a.jumlah_edit_nominal jumlah_update
from eka.mst_diskon_perusahaan a,
eka.lst_user b
 where a.mcl_id = #mcl_id#
and a.jumlah_edit_nominal is not null
and a.user_edit_nominal = b.lus_id
</select>

    <select id="elions.worksite.selectInfoDiskonPerusahaan" resultClass="java.util.HashMap" parameterClass="java.util.Map">
     select rownum, a.nominal, a.mcl_id, b.mcl_first perusahaan, c.nama_lengkap, c.rek_no, c.rek_nama, c.email, a.periode from
             eka.mst_diskon_perusahaan a,
             eka.mst_client_new b,
             eka.mst_company_contact c
             where 
             a.mcl_id = b.mcl_id
             and c.flag_ut = 1
             and jenis = #jenis#
             and a.mcl_id = #mcl_id#
             and a.mcl_id = c.mcl_id
             and b.mcl_id = c.mcl_id
             and rownum = 1
    </select>
    
    <select id="elions.worksite.selectPeriodeList" resultClass="id.co.sinarmaslife.std.model.vo.DropDown" parameterClass="java.util.Map">
    select periode "key", periode "value" from eka.mst_diskon_perusahaan where jenis =1 and mcl_id = #mcl_id#
		and no_pre is  null and flag_perintah_bayar = 1
	</select>
	
	<select id="elions.worksite.selectTglRkFromTbank" resultClass="java.util.Date" parameterClass="string">
		select tgl_rk from eka.mst_tbank where no_pre = #value#
	</select>
	
	<select id="elions.worksite.selectInvoicePayroll" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
		SELECT   t1.*, ROWNUM rn
		FROM (
		        SELECT DISTINCT a.reg_spaj, c.mcl_first nama_pp,
		                i.mcl_first nama_ttg, k.lsdbs_name, 
		                nvl((select sum(mu_jlh_premi) from eka.mst_ulink x 
		                where reg_spaj = a.reg_spaj and lt_id !=10 and mu_tgl_trans = (select mu_tgl_trans from eka.mst_ulink where reg_spaj = a.reg_spaj and mu_ke = 1)), h.mspr_premium) mspr_premium,                  
		                a.lscb_id, l.lca_id, a.mspo_customer, a.lstb_id,
		                a.lspd_id, b.mste_flag_cc, j.lsle_id, h.lsbs_id,
		                b.lssa_id, e.mpt_contact, d.mcl_first nama_pt,
		                g.alamat_kantor, f.nik,
		                SUBSTR (a.reg_spaj, 1, 2)
		                || '.'
		                || SUBSTR (a.reg_spaj, 3, 4)
		                || '.'
		                || SUBSTR (a.reg_spaj, 7) spaj_formatted,
		                DECODE (a.lscb_id, 6, 'M', 'A') cara_bayar,
		                DECODE (b.lssa_id, 1, 'STANDAR',
		                        DECODE (b.lssa_id, 9, 'STANDAR', 
		                        DECODE (b.lssa_id, 2, 'TOLAK', 'PENDING'))
		                ) status,
		                c.mspe_date_birth,
		                decode(m.sub_id, 1, 'PENDING PREMIUM', '') status_tambahan
		                FROM eka.mst_policy a,
		                        eka.mst_insured b,
		                        eka.mst_client_new c,
		                        eka.mst_client_new d,
		                        eka.mst_company e,
		                        eka.mst_worksite_flag f,
		                        eka.mst_address_new g,
		                        eka.mst_product_insured h,
		                        eka.mst_client_new i,
		                        eka.mst_agent_prod j,
		                        eka.lst_det_bisnis k,
		                        eka.mst_agent l,
		                        eka.lst_status_accept_sub m,
		                        eka.mst_position_spaj n
		                WHERE a.reg_spaj = b.reg_spaj
		                        AND a.mspo_policy_holder = c.mcl_id
		                        AND a.mspo_customer = d.mcl_id(+)
		                        AND a.mspo_customer = e.mcl_id(+)
		                        AND a.reg_spaj = f.reg_spaj(+)
		                        AND a.reg_spaj = n.reg_spaj
		                        AND a.lssp_id = n.lssp_id
		                        AND a.lspd_id = n.lspd_id
		                        AND d.mcl_id = g.mcl_id
		                        AND b.reg_spaj = h.reg_spaj
		                        AND b.mste_insured_no = h.mste_insured_no
		                        AND b.mste_insured = i.mcl_id
		                        AND b.lssa_id = n.lssa_id
		                        AND h.reg_spaj = j.reg_spaj
		                        AND h.lsbs_id = k.lsbs_id
		                        AND h.lsdbs_number = k.lsdbs_number
		                        AND j.msag_id = l.msag_id
		                        AND n.lssa_id = m.lssa_id
		                        AND n.sub_id = m.sub_id
		                        AND to_date(n.msps_date,'dd/mm/yyyy') = (select to_date(max(msps_date),'dd/mm/yyyy') from eka.mst_position_spaj where reg_spaj = a.reg_spaj)
		                        AND b.mste_flag_cc = 3
		                        AND a.lspd_id in (1,2)
		                        AND a.lstb_id = 1
		                        AND a.mspo_customer = #customer#
		                        AND l.lca_id = '42'
		                        AND TRUNC (b.mste_input_date) BETWEEN TO_DATE
		                                        (#tgl1#, 'yyyymmdd')
		                                AND TO_DATE
		                                        (#tgl2#, 'yyyymmdd')
		                        AND j.lsle_id = 4
		                UNION
		                SELECT DISTINCT a.reg_spaj, c.mcl_first nama_pp,
		                        i.mcl_first nama_ttg, k.lsdbs_name, 
		                        nvl((select sum(mu_jlh_premi) from eka.mst_ulink x 
		                        where reg_spaj = a.reg_spaj and lt_id !=10 and mu_tgl_trans = (select mu_tgl_trans from eka.mst_ulink where reg_spaj = a.reg_spaj and mu_ke = 1)), h.mspr_premium) mspr_premium,                  
		                        a.lscb_id, l.lca_id, a.mspo_customer, a.lstb_id,
		                        a.lspd_id, b.mste_flag_cc, j.lsle_id, h.lsbs_id,
		                        b.lssa_id, e.mpt_contact, d.mcl_first nama_pt,
		                        g.alamat_kantor, f.nik,
		                        SUBSTR (a.reg_spaj, 1, 2)
		                        || '.'
		                        || SUBSTR (a.reg_spaj, 3, 4)
		                        || '.'
		                        || SUBSTR (a.reg_spaj, 7) spaj_formatted,
		                        DECODE (a.lscb_id, 6, 'M', 'A') cara_bayar,
		                        DECODE (b.lssa_id, 1, 'STANDAR',
		                                DECODE (b.lssa_id, 9, 'STANDAR', 
		                                DECODE (b.lssa_id, 2, 'TOLAK', 'PENDING'))
		                        ) status,
		                        c.mspe_date_birth,
		                        null  status_tambahan
		                FROM eka.mst_policy a,
		                        eka.mst_insured b,
		                        eka.mst_client_new c,
		                        eka.mst_client_new d,
		                        eka.mst_company e,
		                        eka.mst_worksite_flag f,
		                        eka.mst_address_new g,
		                        eka.mst_product_insured h,
		                        eka.mst_client_new i,
		                        eka.mst_agent_prod j,
		                        eka.lst_det_bisnis k,
		                        eka.mst_agent l
		                WHERE a.reg_spaj = b.reg_spaj
		                        AND a.mspo_policy_holder = c.mcl_id
		                        AND a.mspo_customer = d.mcl_id(+)
		                        AND a.mspo_customer = e.mcl_id(+)
		                        AND a.reg_spaj = f.reg_spaj(+)
		                        AND d.mcl_id = g.mcl_id
		                        AND b.reg_spaj = h.reg_spaj
		                        AND b.mste_insured_no = h.mste_insured_no
		                        AND b.mste_insured = i.mcl_id
		                        AND h.reg_spaj = j.reg_spaj
		                        AND h.lsbs_id = k.lsbs_id
		                        AND h.lsdbs_number = k.lsdbs_number
		                        AND j.msag_id = l.msag_id
		                        AND b.mste_flag_cc = 3
		                        AND a.lstb_id = 1
		                        AND ( l.lca_id = '42' OR h.lsbs_id IN (140, 141, 148, 149, 156, 158) )
		                        AND j.lsle_id = 4
		                        AND a.lspd_id in (1,2)
		                        AND b.lssa_id in (1,9,17)
		                        AND a.mspo_customer = #customer#) t1
		WHERE t1.lsbs_id <![CDATA[<]]> 300
		ORDER BY t1.lspd_id, t1.lssa_id, t1.reg_spaj
	</select>
</sqlMap>